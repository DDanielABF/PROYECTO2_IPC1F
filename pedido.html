<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">

    <title>admin</title>
    <style>


    </style>

    <head>
        <h1>Bienvenido Abner</h1>

    <body onload="mostrartabla()" background="adminn.jpg">

        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
            <button onclick="regresar()" class="btn btn-primary me-md-2" type="button">cerrar sesion</button>
            <button onclick="test()" class="btn btn-primary" type="button">generar reporte pdf</button>
        </div>
        <ul class="nav nav-tabs md-tabs" id="myTabMD" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="home-tab-md" data-toggle="tab" href="#home-md" role="tab"
                    aria-controls="home-md" aria-selected="true">Medicos</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="profile-tab-md" data-toggle="tab" href="#profile-md" role="tab"
                    aria-controls="profile-md" aria-selected="true">Pacientes</a>
                 
            </li>
            <li class="nav-item">
                <a class="nav-link" id="contact-tab-md" data-toggle="tab" href="#contact-md" role="tab"
                    aria-controls="contact-md" aria-selected="true">Enfermeros</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="contact-tab-md" data-toggle="tab" href="#medicamento-md" role="tab"
                    aria-controls="contact-md" aria-selected="true">Medicamentos</a>

            </li>
        </ul>
        <div class="tab-content card pt-5" id="myTabContentMD">
            <div class="tab-pane fade show active" id="home-md" role="tabpanel" aria-labelledby="home-tab-md">
                <input type="file" class="form-control" id="file"></input>
                <button onclick="CargaMasiva()" type="button" class="btn btn-secondary btn-lg">Cargar Medicos</button>
                <div style="width: 85; float: center;" id="Daniel">
                    <table class="table table-striped">
                        <thead>
                            <tr class="table-info">
                                <th> Nombre </th>
                                <th> Apellido </th>

                                <th> sexo </th>
                                <th> usuario </th>

                                <th> especialidad </th>
                                <th> telefono </th>
                                <th>
                                    <center>opciones</center>
                                </th>
                            </tr>
                        </thead>
                        <!-- Al igual que los input, a la tabla que queremos agregarle informacion
                    Tambien le agregamos un id. -->
                        <tbody id="detalles"></tbody>
                    </table>
                </div>
            </div>


            <div class="tab-pane fade show active" id="profile-md" role="tabpanel" aria-labelledby="profile-tab-md">
              
                <input type="file" class="form-control" id="file"></input>
                <button onclick="CargaMasiva()" type="button" class="btn btn-secondary btn-lg">Cargar Medicos</button>
                <div style="width: 85; float: center;" id="Daniel">
                    <table class="table table-striped">
                        <thead>
                            <tr class="table-info">
                                <th> Nombre </th>
                                <th> Apellido </th>

                                <th> sexo </th>
                                <th> usuario </th>

                                <th> especialidad </th>
                                <th> telefono </th>
                                <th>
                                    <center>opciones</center>
                                </th>
                            </tr>
                        </thead>
                        <!-- Al igual que los input, a la tabla que queremos agregarle informacion
                    Tambien le agregamos un id. -->
                        <tbody id="detalles"></tbody>
                    </table>
                </div>
              
            </div>



            <div class="tab-pane fade" id="contact-md" role="tabpanel" aria-labelledby="contact-tab-md">
                <p>Etsy mixtape wayfarers, ethical wes anderson tofu before they sold out mcsweeney's organic lomo
                    retro fanny pack lo-fi farm-to-table readymade. Messenger bag gentrify pitchfork tattooed craft
                    beer,
                    iphone skateboard locavore carles etsy salvia banksy hoodie helvetica. DIY synth PBR banksy irony.
                    Leggings gentrify squid 8-bit cred pitchfork. Williamsburg banh mi whatever gluten-free, carles
                    pitchfork biodiesel fixie etsy retro mlkshk vice blog. Scenester cred you probably haven't heard of
                    them, vinyl craft beer blog stumptown. Pitchfork sustainable tofu synth chambray yr.</p>

            </div>

        </div>
        <center>





        </center>

        <!-- Optional JavaScript; choose one of the two! -->

        <!-- Option 1: Bootstrap Bundle with Popper -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/2.3.2/jspdf.plugin.autotable.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
            crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.4.1/jspdf.min.js"></script>
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/2.3.5/jspdf.plugin.autotable.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
        <script src="papaparse.min.js"></script>
        <script src="html2pdf.bundle.js"></script>
        <script>


            function CargaInfo() {
                console.log("usarlo para mandar a tabla")



            }
            function CargaMasiva() {

                $('#file').parse({
                    config: {
                        delimiter: ",",
                        complete: GuardarUsuarios,
                    },
                    before: function (file, inputElem) {
                        console.log("parsing.file...", file);
                    },
                    error: function (err, file) {
                        console.log("ERROR", err, file)
                    },
                    complete: function () {
                        console.log("done with all files")
                        // CargarInfo()
                    }


                });

                function GuardarUsuarios(resultados) {
                    console.log(resultados.data)
                    var data = resultados.data
                    data.shift();
                    data.forEach(element => {
                        console.log("esto es element")
                        console.log(element)
                        console.log("element en x posicion")
                        console.log(element[6])
                        var objDoctor = {
                            'nombre': element[0],
                            'apellido': element[1],
                            'nacimiento': element[2],
                            'sexo': element[3],
                            'usuario': element[4],
                            'contra': element[5],
                            'especialidad': element[6],
                            'telefono': element[7]


                        }
                        console.log("imprimiendo el objeto ya guardado")
                        console.log(objDoctor)
                        if (objDoctor.nombre != null) {
                            fetch('http://localhost:3000/mostrarDoctores', {
                                method: 'POST',
                                body: JSON.stringify(objDoctor),
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Access-Control-Allow-Origin': '*',
                                }
                            })

                                /* SIMULANDO UN TRY - CATCH
                                    El metodo fetch trabaja como una Promesa en JavaScript, representa el estado final del metodo
                                    como si de un return se tratase.
                                    .then: Para indicar que es lo que hara la respuesta del metodo, el primer then sirve para transformar la respuesta 
                                    a un JSON entendible para JavaScript.
                                    .catch: Para indicar que es lo que se hara si se obtuvo un fracaso.
                                */
                                .then(res => res.json())

                                .catch(err => {
                                    console.error('Error:', err)
                                    alert("Ocurrio un error, ver la consola")
                                })
                                /* ULTIMA TRANSFORMACION
                                    Si el metodo funciono correctamente y se logro transformar la respuesta en un JSON, hara lo que este dentro de las llaves.
                                */
                                .then(response => {
                                    // En este apargado, se haran las acciones si la respuesta fue correcta.
                                    console.log(response);
                                    // Usamos un alert, para desplegar un mensaje en pantalla de parte del navegador
                                    // Esto se puede reemplazar con mas librerias.
                                    alert(response.Mensaje)


                                    //  llamar un metodo definido
                                    //ObtenerDatos()
                                })//fetch
                        }


                    });


                }



            }

            function mostrartabla() {
                var tabla = document.querySelector('#detalles')

                // Esta cadena nos servira para escribir los datos en la tabla.
                var cadena = ''

                fetch('http://localhost:3000/doctores', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Access-Control-Allow-Origin': '*',
                    }
                })
                    .then(res => res.json())
                    .catch(err => {
                        console.error('Error:', err)
                        alert("Ocurrio un error, ver la consola")
                    })
                    .then(response => {
                        console.log(response);
                        // Usamos un foreach para darle el valor a un objeto dentro de un arreglo.

                        // arreglo.forEach(variable => {que se hara dentro del for})
                        response.forEach(element => {
                            // En este caso, element es el objeto que esta recorriendo el for, entonces por cada iteracion manipulamos a element
                            console.log(element)
                            // Agregamos a la cadena los datos de la respuesta del JSON para agregarlo a un table.
                            cadena += `<tr>
                        <td> ${element.Nombre} </td>
                        <td> ${element.Apellido} </td>
                        <td> ${element.Sexo} </td>
                        <td> ${element.Usuario} </td>
                        <td> ${element.especialidad} </td>
                        <td> ${element.telefono} </td>
                        <td> <button value=${element.Usuario} onclick="verPerfil(this)" type="button" class="btn btn-outline-dark">Ver Perfil</button> 
                         <button value=${element.Usuario} onclick="verPerfil(this)" type="button" class="btn btn-outline-dark">Actualizar</button> 
                      <button value=${element.Usuario} onclick="Eliminar(this)" type="button" class="btn btn-outline-dark">Eliminar</button></td>
                      
                      </tr>`
                            // Cabe destacar que tambien se pueden agregar otras etiquetas, en si se trabaja como texto.
                            // NOTA: Recuerden no user '' si no que `` para que los deje usar el ${} y agregar variables al texto.
                        });

                        // POR ULTIMO: Usamos innerHTML para agregar el HTML a la etiqueta que indicamos anteriormente.
                        tabla.innerHTML = cadena
                    })
            }

            function login() { }

            // METODO MODIFICAR

            // METODO ELIMINAR
            function Eliminar(button) {
                console.log(button)
                var nombre = button.value

                fetch(`http://localhost:3000/doctores/${nombre}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'Access-Control-Allow-Origin': '*',
                    }
                })
                    .then(res => res.json())
                    .catch(err => {
                        console.error('Error:', err)
                        alert("Ocurrio un error, ver la consola")
                    })
                    .then(response => {
                        console.log(response);
                        alert(response.Mensaje)
                        Actualizar()
                    })





            }
            function Actualizar() {


                window.location.href = 'pedido.html'


            }

            function pruebaDivAPdf() {
                var pdf = new jsPDF('p', 'pt', 'letter');
                source = $('#imprimir')[0];

                specialElementHandlers = {
                    '#bypassme': function (element, renderer) {
                        return true
                    }
                };
                margins = {
                    top: 80,
                    bottom: 60,
                    left: 40,
                    width: 522
                };

                pdf.fromHTML(
                    source,
                    margins.left, // x coord
                    margins.top, { // y coord
                    'width': margins.width,
                    'elementHandlers': specialElementHandlers
                },

                    function (dispose) {
                        pdf.save('Prueba.pdf');
                    }, margins
                );
            }
            function pdfDoctores() {


            }
            function verPerfil(boton) {
                console.log(boton)
                // En mi caso, yo use el value, lo asignamos a una variable.
                var usuario = boton.value

                /* sessionStorage, javascript cuenta con un almacenamiento para la pagina, este almacenamiento
                    estara vigente hasta que se cierre la pagina, es ideal para almacenar datos entre paginas.
                    Usamos el storage.setItem("llave", valor) donde llave es el atributo donde se guardara el valor del sessionStorage
                */
                sessionStorage.setItem("buscar", usuario)

                // CAMBIAR DE PAGINA, SIN USAR OTRA PAGINA
                // Usamos el location.href = "Pagina.html" para cambiar la pagina actual.
                location.href = "Perfil.html"
            }
            function test() {
                // Get the element.
                var element = document.getElementById('Daniel');

                // Generate the PDF.
                html2pdf().from(element).set({
                    margin: 0.5,
                    filename: 'doctores.pdf',
                    html2canvas: { scale: 10 },
                    jsPDF: { orientation: 'landscape', unit: 'in', format: 'letter', compressPDF: true }
                }).save();
            }
            function regresar() {

                location.href = "login.html"
            }
        </script>

        <!-- Option 2: Separate Popper and Bootstrap JS -->
        <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js" integrity="sha384-SR1sx49pcuLnqZUnnPwx6FCym0wLsk5JZuNx2bPPENzswTNFaQU1RDvt3wT4gWFG" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.min.js" integrity="sha384-j0CNLUeiqtyaRmlzUHCPZ+Gy5fQu0dQ6eZ/xAww941Ai1SxSY+0EQqNXNE6DZiVc" crossorigin="anonymous"></script>
    -->
    </body>
</head>

</html>